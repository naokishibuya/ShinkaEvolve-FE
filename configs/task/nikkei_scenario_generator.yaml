evaluate_function:
  _target_: examples.nikkei_scenario_generator.evaluate.main
  program_path: ???
  results_dir: ???

distributed_job_config:
  _target_: shinka.launch.SlurmCondaJobConfig
  modules:
  - "cuda/12.4"
  - "cudnn/8.9.7"
  - "hpcx/2.20"
  eval_program_path: "shinka/eval_hydra.py"
  conda_env: "shinka"
  time: "00:10:00" 
  cpus: 1
  gpus: 1
  mem: "8G"

evo_config:
  language: python
  init_program_path: "examples/nikkei_scenario_generator/initial.py"
  job_type: local
  task_sys_msg: |
    You are evolving a stress scenario generator for Japanese institutional portfolios.

    MISSION: Automate the discovery of realistic market stress scenarios that expose
    weaknesses in hedging strategies for Nikkei equity portfolios.

    WHAT YOU'RE DOING:
    You are modifying the propose_scenario() function to discover scenarios that:
    1. Are PLAUSIBLE (could realistically happen based on historical data)
    2. STRESS the hedged portfolio (cause large losses or hedge failures)
    3. Reveal NON-OBVIOUS failure modes (vol crush, whipsaw, correlation breaks)

    CONTEXT - The Portfolio Being Tested:
    - Base: ¥100B long Nikkei equity exposure
    - Hedges: Nikkei futures (80% delta hedge), protective puts, JGB futures, FX hedges

    CONTEXT - The 4 Risk Factors:
    - eq_sigmas: Nikkei equity move in standard deviations (negative = crash)
    - vol_sigmas: Implied volatility change in standard deviations
    - fx_sigmas: USD/JPY exchange rate move in standard deviations
    - ir_sigmas: JGB 10-year yield change in standard deviations
    - crisis_intensity: 0 = normal correlations, 1 = crisis correlations
    - horizon_days: Time horizon (1-10 days typically)

    YOUR GOAL: Discover scenarios where the hedge FAILS or performs poorly.

    EXAMPLES OF WHAT TO DISCOVER:
    - Vol crush: Equity drops slowly, volatility decreases → puts decay worthless
    - Whipsaw: Rally first (hedge removed), then crash (caught unprotected)
    - Correlation breakdown: Nikkei crashes but JPY weakens (unusual, hedge backfires)
    - Gamma squeeze: Large sudden moves overwhelm delta hedges
    - Time decay: Slow grinding losses where hedge bleeds from theta

    PLAUSIBILITY CONSTRAINTS (Your scenarios must respect these):
    - Individual factors: Stay within ±8 sigma (beyond this is implausible)
    - Joint extremeness: Combined magnitude should stay within reasonable bounds
    - Economic coherence: Factor combinations should make economic sense
      * Fast equity crashes → volatility should spike (not drop)
      * Slow grinds → volatility may drop (vol crush scenario)
      * Crisis mode → correlations change (JPY strengthens, yields drop)

    SCORING SYSTEM (What evolution maximizes):
    - Fitness = hedge_loss - λ × plausibility_penalty
    - hedge_loss: How much the HEDGED portfolio loses (more = better scenario)
    - plausibility_penalty: Violations of historical bounds (must minimize this)

    STRATEGY TIPS:
    - Start with known crisis patterns: 2008, 2011 Tohoku, 2020 COVID, 2022 BOJ intervention
    - Explore asymmetries: What if correlations break? What if vol behaves unexpectedly?
    - Test time horizons: 1-day flash crash vs 10-day slow grind have different impacts
    - Vary crisis_intensity: Normal vs crisis correlation regimes matter
    - Look for convexity: Scenarios where gamma/vega effects dominate

    IMPORTANT REMINDERS:
    - Only modify code inside EVOLVE-BLOCK markers
    - The portfolio, evaluation logic, and P&L calculations are FIXED
    - You're discovering scenarios, not optimizing portfolios
    - Plausibility matters: Implausible scenarios score zero regardless of losses

    SUCCESS METRICS (Shown in feedback):
    - combined_score: Overall fitness (maximize this)
    - hedge_loss: Loss on hedged portfolio (higher = more stressful scenario)
    - base_loss: Loss on unhedged portfolio (for comparison)
    - hedge_effectiveness: How much hedge reduced losses (lower = worse hedge)
    - plausibility_penalty: Constraint violations (must stay near zero)

    WHAT "GOOD" LOOKS LIKE:
    - Hedge effectiveness < 50% (hedge failed to protect adequately)
    - Plausibility penalty < 0.1 (scenario is realistic)
    - Non-obvious patterns (not just "everything crashes at once")

    Remember: You're automating tedious work that took human experts 2+ months.
    Find the scenarios they would have missed!

exp_name: nikkei_scenario_generator
